// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Enquiry {
  id           String   @id @default(cuid())
  customerName String   @map("customer_name")
  email        String
  phone        String?
  product      String
  subject      String
  message      String
  status       EnquiryStatus @default(NEW)
  priority     Priority @default(MEDIUM)
  source       String   @default("Website Form")
  location     String?
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")
  
  // Relations
  responses    EnquiryResponse[]
  
  @@map("enquiries")
}

model EnquiryResponse {
  id        String   @id @default(cuid())
  enquiryId String   @map("enquiry_id")
  message   String
  sentBy    String   @map("sent_by")
  emailSent Boolean  @default(false) @map("email_sent")
  sentAt    DateTime @default(now()) @map("sent_at")
  
  // Relations
  enquiry   Enquiry  @relation(fields: [enquiryId], references: [id], onDelete: Cascade)
  
  @@map("enquiry_responses")
}

model Product {
  id              Int      @id @default(autoincrement())
  name            String
  category        String
  description     String?
  price           Decimal  @default(0) @db.Decimal(10, 2)
  image           String?
  features        Json?
  specifications  Json?
  rating          Decimal  @default(0) @db.Decimal(3, 2)
  reviews         Int      @default(0)
  status          ProductStatus @default(AVAILABLE)
  images          Json?
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")
  
  // Relations
  carts     Cart[]
  orderItems OrderItem[]
  
  @@map("products")
}

model Notification {
  id        String   @id @default(cuid())
  type      NotificationType
  title     String
  message   String
  priority  NotificationPriority @default(MEDIUM)
  read      Boolean  @default(false)
  data      Json?
  createdAt DateTime @default(now()) @map("created_at")
  readAt    DateTime? @map("read_at")
  
  @@map("notifications")
}

model EmailLog {
  id        String   @id @default(cuid())
  toEmail   String   @map("to_email")
  subject   String
  body      String
  type      String
  status    EmailStatus @default(PENDING)
  sentAt    DateTime? @map("sent_at")
  createdAt DateTime @default(now()) @map("created_at")
  
  @@map("email_logs")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String
  role      UserRole @default(ADMIN)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  
  // Relations
  carts     Cart[]
  orders    Order[]
  
  @@map("users")
}

model Settings {
  id        Int      @id @default(autoincrement())
  category  String   @db.VarChar(50)
  key       String   @db.VarChar(100)
  value     String?  @db.Text
  type      String   @default("string") @db.VarChar(20)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  
  @@unique([category, key])
  @@map("settings")
}

model File {
  id         String   @id @default(cuid())
  filename   String
  originalName String @map("original_name")
  url        String
  size       Int
  mimeType   String   @map("mime_type")
  dimensions Json?
  type       String   @default("general")
  folder     String   @default("general")
  uploadedBy String?  @map("uploaded_by")
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")
  
  @@map("files")
}

model Cart {
  id        String   @id @default(cuid())
  userId    String   @map("user_id")
  productId Int      @map("product_id")
  quantity  Int      @default(1)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  
  // Relations
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  @@unique([userId, productId])
  @@map("carts")
}

model Order {
  id            String      @id @default(cuid())
  userId        String      @map("user_id")
  orderNumber   String      @unique @map("order_number")
  status        OrderStatus @default(PENDING)
  totalAmount   Decimal     @map("total_amount") @db.Decimal(10, 2)
  shippingAddress Json?     @map("shipping_address")
  billingAddress  Json?     @map("billing_address")
  paymentStatus PaymentStatus @default(PENDING) @map("payment_status")
  paymentMethod String?     @map("payment_method")
  notes         String?
  createdAt     DateTime    @default(now()) @map("created_at")
  updatedAt     DateTime    @updatedAt @map("updated_at")
  
  // Relations
  user          User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  items         OrderItem[]
  payments      Payment[]
  
  @@map("orders")
}

model OrderItem {
  id        String   @id @default(cuid())
  orderId   String   @map("order_id")
  productId Int      @map("product_id")
  quantity  Int
  price     Decimal  @db.Decimal(10, 2)
  createdAt DateTime @default(now()) @map("created_at")
  
  // Relations
  order     Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  @@map("order_items")
}

model Payment {
  id            String        @id @default(cuid())
  orderId       String        @map("order_id")
  amount        Decimal       @map("amount") @db.Decimal(10, 2)
  currency      String        @default("USD")
  status        PaymentStatus @default(PENDING)
  paymentMethod String        @map("payment_method")
  transactionId String?       @map("transaction_id")
  gateway       String        @default("stripe")
  metadata      Json?
  createdAt     DateTime      @default(now()) @map("created_at")
  updatedAt     DateTime      @updatedAt @map("updated_at")
  
  // Relations
  order         Order         @relation(fields: [orderId], references: [id], onDelete: Cascade)
  
  @@map("payments")
}

// Enums
enum EnquiryStatus {
  NEW
  IN_PROGRESS
  RESPONDED
  CLOSED
}

enum Priority {
  HIGH
  MEDIUM
  LOW
}

enum ProductStatus {
  AVAILABLE
  NOT_AVAILABLE
}

enum NotificationType {
  ENQUIRY
  SYSTEM
  ALERT
}

enum NotificationPriority {
  HIGH
  MEDIUM
  LOW
}

enum EmailStatus {
  SENT
  FAILED
  PENDING
}

enum UserRole {
  ADMIN
  USER
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
}

enum PaymentStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  CANCELLED
  REFUNDED
} 